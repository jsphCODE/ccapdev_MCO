<h2>Your Reservations</h2>

{{#if reservations.length}}
  <div class="row">
    {{#each reservations}}
      <div class="col-md-6 mb-3">
        <div class="card p-3">
          <h5>{{this.flight.origin}} → {{this.flight.destination}}</h5>
          <p><strong>Reservation:</strong> {{shorten this._id}}</p>
          <p><strong>Passenger:</strong> {{this.reserveUser}}</p>
          <p><strong>Seat:</strong> {{this.seat}}</p>
          <p><strong>Date:</strong> {{formatDate this.flight.schedule}}</p>
          <p><strong>Status:</strong>
            <span class="badge {{#if (eq this.status 'succeed')}}bg-success{{else}}bg-danger{{/if}}">
              {{this.status}}
            </span>
          </p>

          <div class="btn-group">
            <button class="btn btn-primary btn-sm view-detail" data-id="{{this._id}}">View Details</button>
            {{#if (eq this.status 'succeed')}}
              <a class="btn btn-warning btn-sm" href="/reservations/{{this._id}}/edit">Edit</a>
              <form action="/reservations/{{this._id}}/cancel" method="POST" style="display:inline;">
                <button class="btn btn-danger btn-sm" onclick="return confirm('Cancel reservation?')">Cancel</button>
              </form>
            {{/if}}
          </div>
        </div>
      </div>
    {{/each}}
  </div>
{{else}}
  <p>No reservations found.</p>
{{/if}}

<!-- Modal -->
<div class="modal fade" id="booking-details" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">Booking Details</h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
    </div>
    <div class="modal-body" id="booking-details-body"></div>
    <div class="modal-footer">
      <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
    </div>
  </div></div>
</div>

<script>
const reservations = {{{json reservations}}};

$(function(){
  $(document).on("click", ".view-detail", function(){
    const id = $(this).data("id");
    const r = reservations.find(x => x._id === id);
    if (!r) return;
    $("#booking-details-body").html(`
      <p><strong>Passenger:</strong> ${r.reserveUser}</p>
      <p><strong>Email:</strong> ${r.reserveEmail}</p>
      <p><strong>Passport:</strong> ${r.passportNo}</p>
      <hr>
      <p><strong>Flight:</strong> ${r.flight.flightNumber}</p>
      <p><strong>Route:</strong> ${r.flight.origin} → ${r.flight.destination}</p>
      <p><strong>Seat:</strong> ${r.seat}</p>
      <p><strong>Meal:</strong> ${r.meal}</p>
      <p><strong>Baggage:</strong> ${r.baggage}</p>
      <p><strong>Created:</strong> ${new Date(r.createdAt).toLocaleString()}</p>
    `);
    new bootstrap.Modal(document.getElementById("booking-details")).show();
  });
});
</script>
