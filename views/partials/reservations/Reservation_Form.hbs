<h1 class="mb-4">Reservation Form</h1>

<style>
.seat{
    width: 50px;
    height: 50px;
    margin: 5px;
}
.seat.selected{
    background-color: green;
    color: white;
}
.seat.reserved{
    background-color: #dc3545;
    color: white;
    pointer-events: none;
}
.seat.available{
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
}
</style>

{{#if flight}}
<div class="flight-info mb-3">
    <h4>Flight Details</h4>
    <p><strong>Flight:</strong> {{flight.flightNumber}}</p>
    <p><strong>Route:</strong> {{flight.origin}} → {{flight.destination}}</p>
    <p><strong>Date:</strong> {{formatDate flight.schedule}}</p>
    <p><strong>Departure:</strong> {{flight.departure}} | <strong>Arrival:</strong> {{flight.arrival}}</p>
</div>
{{/if}}

<form id="reservationForm" action="/reservations/create" method="POST">

    <input type="hidden" name="flight" value="{{flight._id}}">

    <h4>Passenger Information</h4>
    <div class="row">
        <div class="col-md-6 mb-3">
            <label class="form-label">Full Name *</label>
            <input type="text" name="reserveUser" class="form-control" required>
        </div>
        <div class="col-md-6 mb-3">
            <label class="form-label">Email *</label>
            <input type="email" name="reserveEmail" class="form-control" required>
        </div>
    </div>

    <div class="mb-3">
        <label class="form-label">Passport Number *</label>
        <input type="text" name="passportNo" class="form-control" required>
    </div>

    <h4>Seat Selection</h4>

    <div class="mb-3">
        {{#each seatRows}}
        <div class="row justify-content-center mb-2">
            <div class="col-auto">
                {{#each this.aisle1}}
                <button type="button"
                        class="btn seat {{#if this.isReserved}}reserved{{else}}available{{/if}}"
                        data-seat="{{this.id}}"
                        {{#if this.isReserved}}disabled{{/if}}>
                    {{this.id}}
                </button>
                {{/each}}
            </div>

            <div class="col-auto">
                {{#each this.aisle2}}
                <button type="button"
                        class="btn seat {{#if this.isReserved}}reserved{{else}}available{{/if}}"
                        data-seat="{{this.id}}"
                        {{#if this.isReserved}}disabled{{/if}}>
                    {{this.id}}
                </button>
                {{/each}}
            </div>
        </div>
        {{/each}}
    </div>

    <input type="hidden" id="seat" name="seat">

    <h4>Optional Packages</h4>

    <div class="mb-3">
        <label class="form-label">Meal Options:</label>
        <select name="meal" id="meal" class="form-select">
            <option value="standard">Standard</option>
            <option value="vegetarian">Vegetarian</option>
            <option value="kosher">Kosher</option>
            <option value="etc">Other</option>
        </select>
    </div>

    <div class="mb-3">
        <label class="form-label">Extra Baggage:</label>
        <select id="baggage" name="baggage" class="form-select">
            <option value="none">None</option>
            <option value="small">Small</option>
            <option value="medium">Medium</option>
            <option value="large">Large</option>
        </select>
    </div>

    <div id="summary" class="alert alert-info d-none"></div>

    <div class="text-center">
        <button type="submit" class="btn btn-primary btn-lg">Submit Reservation</button>
        <a href="/flights/search" class="btn btn-secondary btn-lg">Cancel</a>
    </div>
</form>

<script>
$(document).ready(function () {

    // Preserve your original seat selection logic
    $(".seat.available").on("click", function () {
        $(".seat").removeClass("selected");
        $(this).addClass("selected");

        $("#seat").val($(this).data("seat"));
    });

    // Preserve your original price computation logic
    $("#reservationForm").on("submit", function (e) {
        e.preventDefault();

        let meal = $("#meal").val();
        let seat = $("#seat").val();
        let baggage = $("#baggage").val();

        if (!seat) {
            $("#summary")
                .removeClass("d-none alert-info")
                .addClass("alert-danger")
                .html("Error: Please select a seat before proceeding.");
            return;
        }

        // Pricing logic (from your file)
        let baseFare = 5000;
        let baggageFee = 0;

        switch (baggage) {
            case "small": baggageFee = 500; break;
            case "medium": baggageFee = 1000; break;
            case "large": baggageFee = 1500; break;
        }

        let mealFee = (meal !== "standard") ? 300 : 0;

        let total = baseFare + baggageFee + mealFee;

        let summaryHtml = `
            <h5>Reservation Summary</h5>
            Meal: ${meal}<br>
            Seat: ${seat}<br>
            Extra Baggage: ${baggage.charAt(0).toUpperCase() + baggage.slice(1)}<br>
            <hr>
            Total Price: ₱${total.toLocaleString()}<br>
            <button type="submit" class="btn btn-success mt-3">Confirm Booking</button>
        `;

        $("#summary")
            .removeClass("d-none alert-danger")
            .addClass("alert-info")
            .html(summaryHtml);
    });
});
</script>


